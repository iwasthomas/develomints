<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="share">
   <insert id="insertShare" parameterType="sv">
   		insert into share_board values 
   		(share_seq.nextval,#{memberNo},#{boardTitle},#{boardContent},#{boardType}, TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS'),#{filename},#{filepath},0)
   </insert>
   <update id="plusPoints" parameterType="sv">
   		update member set member_grade = member_grade+3 where member_no=#{memberNo}
   </update>
   <select id="shareList" parameterType="map" resultType="sv">
		select shb.*,(select count(*) from comments c where c.board_no=shb.boardNo and c.board_type=2) as comments from
		(select rownum as rnum,sb.* from
		(select 
		    member_no as memberNo,
		    board_no as boardNo,
		    board_title as boardtitle,
		    board_content as boardContent,
		    board_type as boardType,
		    reg_date as regDate,
		    filename,
		    s.filepath,
		    read_count as readCount,
		    member_id as memberId,
		    m.filepath as profile,
		    member_grade as memberGrade,
		    (select count(*) from likes lk where s.board_no=lk.board_no) as likes
		from share_board s left join member m using (member_no) 
		order by 
		 <choose> 
		 	<when test="type == 1">
		 		board_no
		 	</when>
		 	<when test="type == 2">
		 		likes
		 	</when>
		 	<when test="type == 3">
		 		read_count
		 	</when>	 	
		 </choose>		
		 desc)sb)shb where rnum between #{start} and #{end};   	
   </select>
   <select id="shareCount">
   		select count(*) from share_board;			
   </select>
</mapper>
